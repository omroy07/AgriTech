<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="/AgriTech/images/logo.png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plant Disease Detector - AI-Powered Diagnosis</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/index.css" />
    <link rel="stylesheet" href="../../theme.css" />

    <!-- Loading Overlay Styles -->
    <style>
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .loading-overlay.active {
        display: flex;
      }

      .loader-box {
        background: #ffffff;
        padding: 30px 40px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }

      .loader-box p {
        margin-top: 15px;
        font-weight: 600;
        color: #2e7d32;
      }

      .spinner {
        width: 48px;
        height: 48px;
        border: 5px solid #c8e6c9;
        border-top-color: #2e7d32;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div class="background-animation">
      <div class="leaf"></div><div class="leaf"></div><div class="leaf"></div>
      <div class="leaf"></div><div class="leaf"></div><div class="leaf"></div>
      <div class="leaf"></div><div class="leaf"></div>
    </div>

    <header class="header">
      <div class="nav-container">
        <div class="logo">
          <i class="fas fa-leaf"></i>
          <span>PlantCare AI</span>
        </div>
        <button class="theme-toggle" aria-label="Toggle dark/light mode">
          <i class="fas fa-sun sun-icon"></i>
          <i class="fas fa-moon moon-icon"></i>
          <span class="theme-text">Light</span>
        </button>
      </div>
    </header>

    <div class="main-container">
      <div class="hero-section">
        <h1 class="hero-title">Plant Disease Detector</h1>
        <p class="hero-subtitle">
          Upload a photo of your plant leaf and get instant AI-powered disease
          diagnosis with treatment recommendations
        </p>
      </div>

      <div class="upload-card">
        <form
          class="upload-form"
          action="/predict"
          method="POST"
          enctype="multipart/form-data"
          id="upload-form"
        >
          <div class="file-upload-area" id="upload-area">
            <div class="upload-content">
              <i class="fas fa-cloud-upload-alt upload-icon"></i>
              <div class="upload-text">Drop your plant image here</div>
              <div class="upload-subtext">
                or click to browse • Supports JPG, PNG, WebP
              </div>
            </div>
            <input
              type="file"
              name="file"
              id="file-input"
              accept="image/*"
              required
            />
          </div>

          <div class="file-preview" id="file-preview">
            <img class="preview-image" id="preview-image" alt="Preview" />
            <div class="file-info">
              <span id="file-name"></span>
              <button type="button" class="remove-file" id="remove-file">
                <i class="fas fa-times"></i> Remove
              </button>
            </div>
          </div>

          <button type="submit" class="submit-btn" id="submit-btn" disabled>
            <span class="btn-text">
              <i class="fas fa-search"></i>
              Analyze Plant Health
            </span>
          </button>
        </form>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loader-box">
        <div class="spinner"></div>
        <p>Analyzing plant image… Please wait</p>
      </div>
    </div>

    <script>
      const uploadArea = document.getElementById("upload-area");
      const fileInput = document.getElementById("file-input");
      const filePreview = document.getElementById("file-preview");
      const previewImage = document.getElementById("preview-image");
      const fileName = document.getElementById("file-name");
      const removeFile = document.getElementById("remove-file");
      const submitBtn = document.getElementById("submit-btn");
      const uploadForm = document.getElementById("upload-form");
      const loadingOverlay = document.getElementById("loading-overlay");

      uploadArea.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          if (!file.type.startsWith("image/")) {
            alert("Please upload a valid image file");
            return;
          }
          const reader = new FileReader();
          reader.onload = (evt) => {
            previewImage.src = evt.target.result;
            fileName.textContent = file.name;
            filePreview.classList.add("show");
            uploadArea.style.display = "none";
            submitBtn.disabled = false;
          };
          reader.readAsDataURL(file);
        }
      });

      removeFile.addEventListener("click", () => {
        fileInput.value = "";
        filePreview.classList.remove("show");
        uploadArea.style.display = "block";
        submitBtn.disabled = true;
      });

      uploadForm.addEventListener("submit", () => {
        loadingOverlay.classList.add("active");
        submitBtn.disabled = true;
      });
    </script>

    <script src="../../theme.js"></script>

    <footer class="footer">
      <p>&copy; 2025 PlantCare AI. All rights reserved.</p>
    </footer>
  </body>
</html>
