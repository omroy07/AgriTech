<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="{{ url_for('disease.static', filename='images/logo.png') }}">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plant Disease Detector</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="{{ url_for('disease.static', filename='index.css') }}">
</head>

<body>

<header style="padding:20px; text-align:center;">
  <h2 style="color:#4CAF50;">ðŸŒ± AgriTech â€“ Plant Disease Detection</h2>
  <nav style="margin-top:10px;">
    <a href="/main" style="margin-right:15px; color:#9ee37d;">Dashboard</a>
    <a href="{{ url_for('disease.disease_home') }}" style="color:#9ee37d;">Disease Home</a>
  </nav>
</header>

<div class="main-container">

  <h1 class="hero-title">Plant Disease Detector</h1>
  <p class="hero-subtitle">
    Upload a plant leaf image to detect disease and get treatment advice
  </p>

  <div class="upload-card">

    <form
      action="{{ url_for('disease.predict_disease') }}"
      method="POST"
      enctype="multipart/form-data"
    >

      <div class="file-upload-area" id="upload-area">
        <i class="fas fa-cloud-upload-alt upload-icon"></i>
        <p>Click to upload plant image</p>
        <small>JPG / PNG only</small>

        <input
          type="file"
          id="file-input"
          name="file"
          accept="image/png,image/jpeg"
          hidden
          required
        />
      </div>

      <div class="file-preview" id="file-preview" style="display:none;">
        <img id="preview-image" style="max-width:100%; border-radius:10px;">
        <p id="file-name"></p>
        <button type="button" id="remove-file">Remove</button>
      </div>

      <!-- âœ… REQUIRED error element -->
      <p
        id="file-error"
        style="display:none; color:#f87171; margin-top:10px;"
      >
        Please upload a valid image file.
      </p>

      <button type="submit" class="submit-btn" id="submit-btn" disabled>
        <i class="fas fa-search"></i> Analyze Plant Health
      </button>

    </form>
  </div>
</div>

<script>
  const uploadArea = document.getElementById("upload-area");
  const fileInput = document.getElementById("file-input");
  const preview = document.getElementById("file-preview");
  const previewImage = document.getElementById("preview-image");
  const fileName = document.getElementById("file-name");
  const removeBtn = document.getElementById("remove-file");
  const submitBtn = document.getElementById("submit-btn");
  const errorText = document.getElementById("file-error");

  uploadArea.onclick = () => fileInput.click();

  fileInput.onchange = () => {
    const file = fileInput.files[0];

    if (!file || !file.type.startsWith("image/")) {
      errorText.style.display = "block";
      submitBtn.disabled = true;
      return;
    }

    errorText.style.display = "none";

    const reader = new FileReader();
    reader.onload = () => {
      previewImage.src = reader.result;
      fileName.textContent = file.name;
      preview.style.display = "block";
      uploadArea.style.display = "none";
      submitBtn.disabled = false;
    };
    reader.readAsDataURL(file);
  };

  removeBtn.onclick = () => {
    fileInput.value = "";
    preview.style.display = "none";
    uploadArea.style.display = "block";
    submitBtn.disabled = true;
  };
</script>

<footer style="text-align:center; margin:40px 0; opacity:0.6;">
  Â© 2026 AgriTech
</footer>

</body>
</html>
